# This file is supposed to be "sourced" from .sti/bin/run
# If you want to have cron jobs from within your container, just add this to
# .sti/bin/run inside your STI-ready repository
#
#   source /usr/bin/nss-wrapper-setup
#   source ${STI_SCRIPTS_PATH}/run
#

echo "Activating NSS wrapper"

export USER_ID=$(id -u)
export GROUP_ID=$(id -g)

if ! id user >/dev/null; then
    {
    cat /etc/passwd
    echo "user:x:${USER_ID}:${GROUP_ID}:Openshift User:${HOME}:/sbin/nologin"
    } > /tmp/passwd
fi
export LD_PRELOAD=libnss_wrapper.so
export NSS_WRAPPER_PASSWD=/tmp/passwd
export NSS_WRAPPER_GROUP=/etc/group
